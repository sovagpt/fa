<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polymarket AI Betting Advisor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #ffffff;
        }

        .chat-container {
            width: 100%;
            max-width: 1000px;
            height: 90vh;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-header {
            background: linear-gradient(135deg, #000000, #1a1a1a);
            color: white;
            padding: 24px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-header h1 {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ffffff, #a0a0a0);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .chat-header p {
            opacity: 0.8;
            font-size: 1rem;
            font-weight: 400;
            color: #b0b0b0;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            background: rgba(0, 0, 0, 0.4);
        }

        .message {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            animation: fadeIn 0.6s ease;
            max-width: 100%;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 0.9rem;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
        }

        .message.bot .message-avatar {
            background: linear-gradient(135deg, #000000, #374151);
        }

        .message-content {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 20px 24px;
            border-radius: 16px;
            max-width: 75%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            line-height: 1.6;
            color: #ffffff;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* AI Response Formatting */
        .ai-response h3 {
            color: #ffffff;
            font-size: 1.1rem;
            font-weight: 700;
            margin: 16px 0 8px 0;
            padding-bottom: 4px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .ai-response p {
            margin-bottom: 12px;
            color: #e5e5e5;
        }

        .ai-response ul, .ai-response ol {
            margin: 12px 0 12px 20px;
            color: #e5e5e5;
        }

        .ai-response li {
            margin-bottom: 6px;
        }

        .ai-response strong {
            color: #ffffff;
            font-weight: 600;
        }

        .market-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.04));
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .market-card:hover {
            border-color: rgba(37, 99, 235, 0.5);
            box-shadow: 0 12px 35px rgba(37, 99, 235, 0.2);
            transform: translateY(-2px);
        }

        .market-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #2563eb, #1d4ed8, #1e40af);
        }

        .market-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 18px;
        }

        .market-title {
            font-weight: 700;
            color: #ffffff;
            font-size: 1.05rem;
            line-height: 1.4;
            flex: 1;
            padding-right: 16px;
        }

        .market-image {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            object-fit: cover;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
        }

        .market-outcomes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            margin: 18px 0;
        }

        .outcome {
            padding: 14px 18px;
            border-radius: 12px;
            text-align: center;
            font-size: 0.95rem;
            font-weight: 700;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .outcome:hover {
            transform: scale(1.03);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .outcome.favored {
            background: linear-gradient(135deg, #059669, #047857);
            color: white;
            border-color: rgba(5, 150, 105, 0.3);
        }

        .outcome.underdog {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            border-color: rgba(220, 38, 38, 0.3);
        }

        .outcome.neutral {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
            border-color: rgba(107, 114, 128, 0.3);
        }

        .market-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin-top: 18px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-item {
            text-align: center;
            padding: 8px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.03);
        }

        .stat-label {
            display: block;
            margin-bottom: 4px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #9ca3af;
            font-weight: 600;
        }

        .stat-value {
            font-weight: 800;
            color: #ffffff;
            font-size: 0.95rem;
        }

        .market-actions {
            display: flex;
            gap: 12px;
            margin-top: 18px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .action-button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .analyze-button {
            background: linear-gradient(135deg, #374151, #1f2937);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .analyze-button:hover {
            background: linear-gradient(135deg, #4b5563, #374151);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .polymarket-button {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
        }

        .polymarket-button:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);
        }

        .chat-input-container {
            padding: 24px;
            background: rgba(0, 0, 0, 0.6);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .chat-input {
            display: flex;
            gap: 16px;
            align-items: flex-end;
        }

        .input-field {
            flex: 1;
            padding: 16px 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            color: #ffffff;
            font-size: 1rem;
            resize: none;
            max-height: 120px;
            min-height: 56px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .input-field::placeholder {
            color: #9ca3af;
        }

        .input-field:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            background: rgba(255, 255, 255, 0.12);
        }

        .send-button {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            border: none;
            padding: 0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(37, 99, 235, 0.3);
            font-size: 1.2rem;
        }

        .send-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(37, 99, 235, 0.4);
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
        }

        .send-button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 12px;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: fit-content;
            margin-bottom: 20px;
            color: #b0b0b0;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #2563eb;
            animation: typing 1.5s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; transform: scale(0.8); }
            30% { opacity: 1; transform: scale(1); }
        }

        .typing-cursor::after {
            content: '|';
            animation: blink-caret 1s infinite;
            color: #2563eb;
            font-weight: bold;
        }

        @keyframes blink-caret {
            from, to { opacity: 1; }
            50% { opacity: 0; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            color: #b0b0b0;
        }

        .welcome-message h2 {
            color: #ffffff;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .welcome-message p {
            font-size: 1.05rem;
            line-height: 1.6;
            margin-bottom: 30px;
            color: #9ca3af;
        }

        .example-questions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 30px;
        }

        .example-question {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 18px 22px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            color: #e5e5e5;
            font-weight: 500;
            text-align: left;
            backdrop-filter: blur(5px);
        }

        .example-question:hover {
            background: rgba(37, 99, 235, 0.1);
            border-color: rgba(37, 99, 235, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .ai-analysis {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(29, 78, 216, 0.05));
            border: 1px solid rgba(37, 99, 235, 0.2);
            border-radius: 16px;
            padding: 24px;
            margin: 20px 0;
            border-left: 4px solid #2563eb;
            backdrop-filter: blur(5px);
        }

        .ai-analysis-header {
            font-weight: 800;
            color: #ffffff;
            margin-bottom: 16px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .ai-analysis-content {
            color: #e5e5e5;
            line-height: 1.7;
        }

        .polymarket-link {
            padding: 8px 16px;
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 700;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .polymarket-link:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        /* Markets Section */
        .markets-section {
            margin-top: 24px;
        }

        .markets-header {
            font-size: 1.1rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @media (max-width: 768px) {
            .chat-container {
                height: 95vh;
                margin: 10px;
                max-width: none;
                border-radius: 16px;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .market-outcomes {
                grid-template-columns: 1fr;
            }

            .example-questions {
                grid-template-columns: 1fr;
            }

            .market-stats {
                grid-template-columns: 1fr 1fr;
            }

            .market-actions {
                flex-direction: column;
            }

            .ai-analysis-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .chat-input {
                flex-direction: column;
                gap: 12px;
            }

            .send-button {
                width: 100%;
                height: 48px;
                border-radius: 12px;
            }
        }

        /* Scrollbar Styling */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
            /* Enhanced background glow */
        body::before,
        body::after { content: ""; position: fixed; z-index: -1; width: 60vmax; height: 60vmax; filter: blur(70px); opacity: 0.35; transform: translateZ(0); pointer-events: none; }
        body::before { top: -20vmax; left: -10vmax; background: radial-gradient(circle at center, rgba(37, 99, 235, 0.45), rgba(29, 78, 216, 0.25), transparent 60%); animation: floatA 26s ease-in-out infinite; }
        body::after { bottom: -25vmax; right: -15vmax; background: radial-gradient(circle at center, rgba(0, 212, 255, 0.35), rgba(155, 89, 182, 0.25), transparent 60%); animation: floatB 34s ease-in-out infinite; }
        @keyframes floatA { 0%, 100% { transform: translate(0,0) scale(1);} 50% { transform: translate(3vmax,2vmax) scale(1.05);} }
        @keyframes floatB { 0%, 100% { transform: translate(0,0) scale(1);} 50% { transform: translate(-3vmax,-2vmax) scale(1.05);} }
        .top-right-icons { position: fixed; top: 18px; right: 20px; display: flex; gap: 10px; z-index: 1000; }
        .icon-btn { width: 44px; height: 44px; display: inline-flex; align-items: center; justify-content: center; border-radius: 12px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.18); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); box-shadow: 0 6px 18px rgba(0,0,0,0.35); transition: transform 0.25s ease, background 0.25s ease, box-shadow 0.25s ease; }
        .icon-btn:hover { transform: translateY(-2px); background: rgba(255,255,255,0.10); box-shadow: 0 10px 24px rgba(0,0,0,0.45); }
        .icon-btn img { width: 22px; height: 22px; object-fit: contain; display: block; }
        .chat-container { background: rgba(16, 18, 28, 0.38); backdrop-filter: blur(22px) saturate(120%); -webkit-backdrop-filter: blur(22px) saturate(120%); border: 1px solid rgba(255,255,255,0.12); box-shadow: 0 25px 50px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.06); }
        .chat-container::before { content: ""; position: absolute; inset: 0; border-radius: inherit; padding: 1px; background: linear-gradient(135deg, rgba(255,255,255,0.18), rgba(255,255,255,0.04)); -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); -webkit-mask-composite: xor; mask-composite: exclude; pointer-events: none; }
        .chat-header { background: transparent; border-bottom: 1px solid rgba(255,255,255,0.08); }
        /* Hide in-card and analysis Polymarket links */
        .polymarket-button, .polymarket-link { display: none !important; }
        /* Animated background shift */
        @keyframes bgShift { 0% { background-position: 0% 0%, 100% 0%, 0% 100%, 0% 0%; } 100% { background-position: 50% 50%, 50% 50%, 50% 50%, 100% 100%; } }
        /* About button */
        .about-btn { height: 44px; padding: 0 14px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.18); background: rgba(255,255,255,0.06); color: #fff; font-weight: 600; letter-spacing: .2px; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); cursor: pointer; transition: transform .2s ease, background .2s ease; }
        .about-btn:hover { transform: translateY(-2px); background: rgba(255,255,255,0.10); }
        /* Site footer */
        .site-footer { position: fixed; left: 50%; bottom: 12px; transform: translateX(-50%); display: flex; align-items: center; gap: 12px; padding: 10px 14px; border-radius: 14px; background: rgba(16,18,28,0.45); border: 1px solid rgba(255,255,255,0.12); backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px); box-shadow: 0 8px 24px rgba(0,0,0,0.35); z-index: 900; }
        .footer-title { color: #d6d6d6; font-weight: 700; font-size: .95rem; }
        .footer-icons { display: inline-flex; gap: 8px; }
        /* 3D panel */
        .threeD-panel { position: fixed; left: 16px; bottom: 16px; width: 300px; height: 220px; border-radius: 16px; background: rgba(16,18,28,0.5); border: 1px solid rgba(255,255,255,0.12); backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px); box-shadow: 0 8px 24px rgba(0,0,0,0.35); z-index: 900; display: flex; flex-direction: column; overflow: hidden; }
        .threeD-header { display: flex; align-items: center; justify-content: space-between; padding: 8px 10px; border-bottom: 1px solid rgba(255,255,255,0.12); color: #e5e5e5; font-weight: 700; }
        .panel-close { background: transparent; border: none; color: #e5e5e5; font-size: 18px; cursor: pointer; }
        .threeD-body { flex: 1; display: grid; place-items: center; color: #b8c1ce; font-size: .95rem; }
        .threeD-placeholder { opacity: .8; }
        /* Modal */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { position: relative; width: min(680px, 92vw); background: rgba(16,18,28,0.8); border: 1px solid rgba(255,255,255,0.12); border-radius: 16px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); padding: 22px; color: #e5e5e5; }
        .modal-content h2 { color: #fff; margin-bottom: 10px; }
        .modal-close { position: absolute; top: 10px; right: 14px; background: transparent; border: none; color: #e5e5e5; font-size: 22px; cursor: pointer; }
        /* Avatars */
        .message-avatar { width: 44px; height: 44px; border-radius: 50%; overflow: hidden; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: .8rem; color: #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .avatar-user { background: linear-gradient(135deg, #2563eb, #1d4ed8); }
        .avatar-bot img { width: 100%; height: 100%; object-fit: cover; display: block; }
        @media (max-width: 768px) { .site-footer { bottom: 8px; padding: 8px 10px; } .threeD-panel { width: 260px; height: 190px; left: 10px; bottom: 10px; } }
    </style>
</head>

    <!-- Top-right social buttons -->
    <div class="top-right-icons">
        <a class="icon-btn" href="https://twitter.com" target="_blank" rel="noopener" aria-label="Twitter">
            <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/68a663251731174a3dc255f1_689178ebf786d570b0c29520_tw%20(1).png" alt="Twitter" />
        </a>
        <a class="icon-btn" href="https://polymarket.com" target="_blank" rel="noopener" aria-label="Polymarket">
            <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/68c43c9ba4355c1b5e0d63da_68a663251731174a3dc255f1_689178ebf786d570b0c29520_tw%20(1)%20(1).png" alt="Polymarket" />
        </a>
        <button class="about-btn" id="aboutBtn" type="button">About</button>
    </div>
    <div class="chat-container">
        <div class="chat-header">
            <h1>Polymarket AI Advisor</h1>
            <p>Intelligent insights on prediction markets with real-time analysis</p>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                <h2>Welcome to Your AI Betting Advisor</h2>
                <p>Ask me about any betting markets and I'll provide data-driven analysis and predictions to help guide your decisions.</p>
                <div class="example-questions">
                    <div class="example-question" onclick="askQuestion('Who will win the Premier League this season?')">
                        Premier League winner predictions
                    </div>
                    <div class="example-question" onclick="askQuestion('What are the Fed interest rate predictions?')">
                        Federal Reserve rate predictions
                    </div>
                    <div class="example-question" onclick="askQuestion('Show me the highest volume markets')">
                        Highest volume betting markets
                    </div>
                    <div class="example-question" onclick="askQuestion('What NFL games should I bet on?')">
                        NFL betting recommendations
                    </div>
                </div>
                </div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <span>AI is analyzing markets...</span>
        </div>

        <div class="chat-input-container">
            <div class="chat-input">
                <textarea 
                    class="input-field" 
                    id="messageInput" 
                    placeholder="Ask me about any betting opportunity..."
                    rows="1"
                ></textarea>
                <button class="send-button" id="sendButton" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            POLYMARKET_DATA_URL: 'https://raw.githubusercontent.com/sovagpt/fa/main/polymarket_markets_full.json',
            OPENROUTER_API_URL: 'https://openrouter.ai/api/v1/chat/completions',
            MODEL: 'anthropic/claude-3.5-sonnet:beta'
        };

        // Global variables
        let polymarketData = null;
        let chatHistory = [];
        let isLoading = false;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            try {
                await loadPolymarketData();
                setupEventListeners();
            } catch (error) {
                console.error('Failed to initialize app:', error);
            }
        }

        async function loadPolymarketData() {
            try {
                const response = await fetch(CONFIG.POLYMARKET_DATA_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                polymarketData = await response.json();
                console.log(`Loaded ${polymarketData.markets?.length || 0} markets`);
                
            } catch (error) {
                console.error('Error loading Polymarket data:', error);
                throw error;
            }
        }

        function setupEventListeners() {
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');

            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });

            sendButton.addEventListener('click', sendMessage);
            // About modal handlers
            const aboutBtn = document.getElementById('aboutBtn');
            const aboutModal = document.getElementById('aboutModal');
            const aboutClose = document.getElementById('aboutClose');
            if (aboutBtn && aboutModal) {
                aboutBtn.addEventListener('click', () => { aboutModal.style.display = 'flex'; });
                if (aboutClose) aboutClose.addEventListener('click', () => { aboutModal.style.display = 'none'; });
                aboutModal.addEventListener('click', (e) => { if (e.target === aboutModal) aboutModal.style.display = 'none'; });
            }
            // 3D panel close handler
            const closeThreeDPanel = document.getElementById('closeThreeDPanel');
            const threeDPanel = document.getElementById('threeDPanel');
            if (closeThreeDPanel && threeDPanel) {
                closeThreeDPanel.addEventListener('click', () => { threeDPanel.style.display = 'none'; });
            }
        }

        function askQuestion(question) {
            const messageInput = document.getElementById('messageInput');
            messageInput.value = question;
            sendMessage();
        }

        async function sendMessage() {
            if (isLoading) return;
            
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            if (!polymarketData) {
                alert('Market data is still loading. Please wait a moment and try again.');
                return;
            }

            const welcomeMsg = document.querySelector('.welcome-message');
            if (welcomeMsg) {
                welcomeMsg.remove();
            }

            input.value = '';
            input.style.height = 'auto';
            
            addMessage('user', message);
            showTypingIndicator();
            
            try {
                isLoading = true;
                const relevantMarkets = findRelevantMarkets(message);
                const response = await getAIResponse(message, relevantMarkets);
                hideTypingIndicator();
                addMessage('bot', response, relevantMarkets);
            } catch (error) {
                console.error('Error getting AI response:', error);
                hideTypingIndicator();
                addMessage('bot', 'I encountered an error while processing your request. Please try again.');
            } finally {
                isLoading = false;
            }
        }

        async function getAIResponse(userMessage, relevantMarkets) {
            const context = createAIContext(userMessage, relevantMarkets);
            const aiResponse = await callOpenRouterAPI(context);
            return formatAIResponse(aiResponse);
        }

        function formatAIResponse(response) {
            // Format the AI response with proper HTML structure for better readability
            let formattedResponse = response;
            
            // Add paragraph breaks for better formatting
            formattedResponse = formattedResponse
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>');
            
            // Wrap in paragraph tags
            if (!formattedResponse.startsWith('<')) {
                formattedResponse = '<p>' + formattedResponse + '</p>';
            }
            
            // Format numbered lists
            formattedResponse = formattedResponse.replace(/(\d+\.\s)/g, '<br><strong>$1</strong>');
            
            // Bold key phrases
            formattedResponse = formattedResponse.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            return `<div class="ai-response">${formattedResponse}</div>`;
        }

        function findRelevantMarkets(query) {
            const queryLower = query.toLowerCase();
            const markets = polymarketData.markets || [];
            
            const categories = {
                'premier_league': ['premier league', 'epl', 'english premier', 'manchester', 'liverpool', 'chelsea', 'arsenal', 'tottenham'],
                'football': ['football', 'soccer', 'fifa', 'world cup', 'uefa', 'champions league'],
                'american_football': ['nfl', 'super bowl', 'american football', 'chiefs', 'cowboys', 'patriots'],
                'basketball': ['nba', 'basketball', 'lakers', 'warriors', 'lebron', 'finals'],
                'baseball': ['mlb', 'baseball', 'yankees', 'dodgers', 'world series'],
                'fed_rates': ['fed', 'federal reserve', 'interest rate', 'fomc', 'jerome powell'],
                'politics': ['election', 'president', 'biden', 'trump', 'congress', 'senate'],
                'crypto': ['bitcoin', 'ethereum', 'crypto', 'btc', 'eth', 'binance', 'coinbase'],
                'stocks': ['stock', 'nasdaq', 'dow', 'sp500', 's&p', 'apple', 'tesla', 'nvidia'],
                'entertainment': ['oscar', 'emmy', 'grammy', 'movie', 'netflix', 'disney']
            };
            
            let searchScore = {};
            
            markets.forEach((market, index) => {
                const title = market.title.toLowerCase();
                const description = market.description.toLowerCase();
                let score = 0;
                
                const queryWords = queryLower.split(' ').filter(word => word.length > 2);
                queryWords.forEach(word => {
                    if (title.includes(word)) score += 10;
                    if (description.includes(word)) score += 5;
                });
                
                Object.entries(categories).forEach(([category, keywords]) => {
                    keywords.forEach(keyword => {
                        if (queryLower.includes(keyword)) {
                            if (title.includes(keyword) || description.includes(keyword)) {
                                score += 15;
                            }
                        }
                    });
                });
                
                if (market.volume24h > 1000000) score += 3;
                if (market.volume24h > 5000000) score += 2;
                
                if (score > 0) {
                    searchScore[index] = score;
                }
            });
            
            let relevantMarkets = Object.entries(searchScore)
                .sort(([, a], [, b]) => b - a)
                .slice(0, 6)
                .map(([index]) => markets[parseInt(index)]);
            
            if (relevantMarkets.length === 0) {
                relevantMarkets = markets
                    .filter(m => m.volume24h > 0)
                    .sort((a, b) => (b.volume24h || 0) - (a.volume24h || 0))
                    .slice(0, 5);
            }
            
            return relevantMarkets;
        }

        function createAIContext(userMessage, relevantMarkets) {
            const marketData = relevantMarkets.map(market => ({
                title: market.title,
                description: market.description,
                outcomes: market.outcomes,
                volume24h: market.volume24h,
                volumeTotal: market.volumeTotal,
                liquidity: market.liquidity,
                favoredOutcome: market.favoredOutcome
            }));
            
            return `
User Question: "${userMessage}"

Relevant Betting Markets Data:
${JSON.stringify(marketData, null, 2)}

Instructions:
1. Analyze the provided betting markets data relevant to the user's question
2. Give your expert opinion on the most likely outcomes based on market data
3. Explain your reasoning using odds, volume, and market sentiment
4. Be conversational and engaging
5. Format your response with clear structure and paragraphs
6. Use bullet points or numbered lists where appropriate
7. Consider volume and liquidity as indicators of market confidence
8. Don't mention that you're looking at JSON data - analyze the markets naturally
9. Keep sections well-organized with clear headings when discussing multiple topics

Provide your analysis and predictions based on this market data.
`;
        }

        async function callOpenRouterAPI(context) {
            let apiKey;
            try {
                const keyResponse = await fetch('/api/get-api-key');
                const keyData = await keyResponse.json();
                apiKey = keyData.apiKey;
            } catch (error) {
                console.error('Failed to get API key:', error);
                throw new Error('API key not available');
            }

            const response = await fetch(CONFIG.OPENROUTER_API_URL, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json',
                    'HTTP-Referer': window.location.origin,
                    'X-Title': 'Polymarket AI Advisor'
                },
                body: JSON.stringify({
                    model: CONFIG.MODEL,
                    messages: [
                        {
                            role: 'system',
                            content: 'You are an expert betting analyst who provides intelligent insights on prediction markets. Analyze market data and give clear, well-formatted predictions with reasoning. Structure your responses with clear paragraphs and use formatting to make information easily digestible.'
                        },
                        {
                            role: 'user',
                            content: context
                        }
                    ],
                    max_tokens: 1000,
                    temperature: 0.7
                })
            });
            
            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`OpenRouter API error: ${response.status} - ${errorText}`);
            }
            
            const data = await response.json();
            return data.choices[0].message.content;
        }

        function createMarketCard(market, index) {
            const formatVolume = (vol) => {
                if (!vol || vol === 0) return '$0';
                if (vol > 1000000) return `${(vol / 1000000).toFixed(1)}M`;
                if (vol > 1000) return `${(vol / 1000).toFixed(1)}K`;
                return `${vol.toFixed(0)}`;
            };
            
            const formatPrice = (price) => `${(price * 100).toFixed(1)}%`;
            
            const outcome1 = market.outcomes[0];
            const outcome2 = market.outcomes[1];
            
            const outcome1Class = outcome1.price > 0.6 ? 'favored' : outcome1.price < 0.4 ? 'underdog' : 'neutral';
            const outcome2Class = outcome2.price > 0.6 ? 'favored' : outcome2.price < 0.4 ? 'underdog' : 'neutral';
            
            
            return `
                <div class="market-card">
                    <div class="market-header">
                        <div class="market-title">${market.title}</div>
                        ${market.image ? `<img src="${market.image}" alt="Market" class="market-image" onerror="this.style.display='none'">` : ''}
                    </div>
                    <div class="market-outcomes">
                        <div class="outcome ${outcome1Class}">
                            ${outcome1.name}: ${formatPrice(outcome1.price)}
                        </div>
                        <div class="outcome ${outcome2Class}">
                            ${outcome2.name}: ${formatPrice(outcome2.price)}
                        </div>
                    </div>
                    <div class="market-stats">
                        <div class="stat-item">
                            <span class="stat-label">24h Volume</span>
                            <span class="stat-value">${formatVolume(market.volume24h)}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Total Volume</span>
                            <span class="stat-value">${formatVolume(market.volumeTotal)}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Liquidity</span>
                            <span class="stat-value">${formatVolume(market.liquidity)}</span>
                        </div>
                    </div>
                    <div class="market-actions">
                        <button class="action-button analyze-button" onclick="analyzeSpecificMarket('${market.id}', '${market.title.replace(/'/g, "\\'")}')">
                            AI Analysis
                        </button>
                    </div>
                </div>
            `;
        }

        async function analyzeSpecificMarket(marketId, marketTitle) {
            const market = polymarketData.markets.find(m => m.id === marketId);
            if (!market) return;
            
            addMessage('user', `Tell me more about: ${marketTitle}`);
            showTypingIndicator();
            
            try {
                const detailedAnalysis = await getDetailedMarketAnalysis(market);
                hideTypingIndicator();
                addMessage('bot', detailedAnalysis, [market]);
            } catch (error) {
                console.error('Error getting detailed analysis:', error);
                hideTypingIndicator();
                addMessage('bot', 'I couldn\'t analyze this specific market right now. Please try again.');
            }
        }

        async function getDetailedMarketAnalysis(market) {
            const context = `
Provide a detailed analysis of this specific betting market:

Title: ${market.title}
Description: ${market.description}
Outcomes: ${JSON.stringify(market.outcomes)}
24h Volume: ${market.volume24h}
Total Volume: ${market.volumeTotal}
Liquidity: ${market.liquidity}
Favored Outcome: ${market.favoredOutcome}
End Date: ${market.endTime}

Please provide a well-structured analysis with:
1. What this market is betting on (in simple terms)
2. Current odds analysis
3. Your prediction and confidence level
4. Key factors that could influence the outcome
5. Risk assessment

Format your response clearly with proper structure and paragraphs.
`;

            const aiResponse = await callOpenRouterAPI(context);
            
            return `
                <div class="ai-analysis">
                    <div class="ai-analysis-header">
                        <span>Detailed Market Analysis</span>
                    </div>
                    <div class="ai-analysis-content">
                        ${formatAIResponse(aiResponse)}
                    </div>
                </div>
            `;
        }

        function addMessage(sender, content, relevantMarkets = null) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            if (sender === "user") { avatar.classList.add("avatar-user"); avatar.textContent = "YOU"; } else { avatar.classList.add("avatar-bot"); avatar.innerHTML = "<img src=\"https://placehold.co/44x44\" alt=\"PolyGF\" />"; }
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            if (sender === 'bot') {
                startTypewriterEffect(contentDiv, content, relevantMarkets);
            } else {
                contentDiv.innerHTML = content;
            }
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
            messagesContainer.appendChild(messageDiv);
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            chatHistory.push({ sender, content });
        }

        function startTypewriterEffect(element, htmlContent, relevantMarkets = null) {
            element.innerHTML = '';
            element.classList.add('typing-cursor');
            
            let currentIndex = 0;
            const speed = 15;
            const textOnly = htmlContent.replace(/<[^>]*>/g, '');
            
            function typeNextChar() {
                if (currentIndex < textOnly.length) {
                    let htmlToShow = '';
                    let textIndex = 0;
                    let htmlIndex = 0;
                    
                    while (htmlIndex < htmlContent.length && textIndex <= currentIndex) {
                        if (htmlContent[htmlIndex] === '<') {
                            const tagEnd = htmlContent.indexOf('>', htmlIndex);
                            if (tagEnd !== -1) {
                                htmlToShow += htmlContent.substring(htmlIndex, tagEnd + 1);
                                htmlIndex = tagEnd + 1;
                            } else {
                                htmlIndex++;
                            }
                        } else {
                            htmlToShow += htmlContent[htmlIndex];
                            if (htmlContent[htmlIndex] !== ' ' || textIndex < currentIndex) {
                                textIndex++;
                            }
                            htmlIndex++;
                        }
                    }
                    
                    element.innerHTML = htmlToShow;
                    currentIndex++;
                    
                    const messagesContainer = document.getElementById('chatMessages');
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    
                    setTimeout(typeNextChar, speed);
                } else {
                    element.innerHTML = htmlContent;
                    element.classList.remove('typing-cursor');
                    
                    if (relevantMarkets && relevantMarkets.length > 0) {
                        setTimeout(() => {
                            const marketsSection = document.createElement('div');
                            marketsSection.className = 'markets-section';
                            marketsSection.innerHTML = `
                                <div class="markets-header">
                                    Relevant Markets
                                </div>
                            `;
                            
                            relevantMarkets.forEach((market) => {
                                const marketDiv = document.createElement('div');
                                marketDiv.innerHTML = createMarketCard(market, 0);
                            });
                            
                            element.appendChild(marketsSection);
                            
                            const messagesContainer = document.getElementById('chatMessages');
                            messagesContainer.scrollTop = messagesContainer.scrollHeight;
                        }, 300);
                    }
                }
            }
            
            typeNextChar();
        }

        function showTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            const messagesContainer = document.getElementById('chatMessages');
            indicator.style.display = 'flex';
            messagesContainer.appendChild(indicator);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            indicator.style.display = 'none';
        }

        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled promise rejection:', e.reason);
        });
    </script>
    <div class="site-footer">
        <span class="footer-title">Polymarket AI Advisor</span>
        <div class="footer-icons">
            <a class="icon-btn" href="https://twitter.com" target="_blank" rel="noopener" aria-label="Twitter">
                <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/68a663251731174a3dc255f1_689178ebf786d570b0c29520_tw%20(1).png" alt="Twitter" />
            </a>
            <a class="icon-btn" href="https://polymarket.com" target="_blank" rel="noopener" aria-label="Polymarket">
                <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/68c43c9ba4355c1b5e0d63da_68a663251731174a3dc255f1_689178ebf786d570b0c29520_tw%20(1)%20(1).png" alt="Polymarket" />
            </a>
            <a class="icon-btn" href="#" target="_blank" rel="noopener" aria-label="GitHub">
                <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/68c4422ee520797f737eea3f_68c43c9ba4355c1b5e0d63da_68a663251731174a3dc255f1_689178ebf786d570b0c29520_tw%20(1)%20(1)%20(1).png" alt="GitHub" />
            </a>
        </div>
    </div>

    <div class="threeD-panel" id="threeDPanel">
        <div class="threeD-header">
            <span>3D Character</span>
            <button class="panel-close" id="closeThreeDPanel" type="button">Close</button>
        </div>
        <div class="threeD-body">
            <div class="threeD-placeholder">3D model coming soon</div>
        </div>
    </div>

    <div class="modal-overlay" id="aboutModal" style="display:none;">
        <div class="modal-content">
            <button class="modal-close" id="aboutClose" type="button">Close</button>
            <h2>About PolyGF</h2>
            <p>PolyGF is an AI LLM expert on Polymarket that discovers good bets and markets for users.</p>
            <p>She will operate as an autonomous trader, livestreaming her Polymarket activity and progress on pump.fun.</p>
            <p>Goal: become the number one trader on Polymarket.</p>
            <p>Funding: uses 10% of creator rewards for Polymarket trades, and 90% for $POLYGF coin buybacks.</p>
        </div>
    </div>
</body>
</html>



