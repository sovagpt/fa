<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polymarket AI Betting Advisor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chat-container {
            width: 100%;
            max-width: 900px;
            height: 85vh;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chat-header {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .chat-header h1 {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .chat-header p {
            opacity: 0.9;
            font-size: 0.95rem;
            margin-bottom: 10px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            animation: fadeIn 0.5s ease;
            max-width: 100%;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .message.bot .message-avatar {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
        }

        .message-content {
            background: white;
            padding: 16px 20px;
            border-radius: 20px;
            max-width: 75%;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 0, 0, 0.05);
            line-height: 1.5;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .market-card {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 18px;
            margin: 12px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .market-card:hover {
            border-color: #6366f1;
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.15);
            transform: translateY(-2px);
        }

        .market-card::before {
            content: 'üéØ';
            position: absolute;
            top: 15px;
            right: 18px;
            font-size: 1.2rem;
        }

        .market-title {
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 12px;
            font-size: 1rem;
            line-height: 1.4;
            padding-right: 35px;
        }

        .market-outcomes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 15px 0;
        }

        .outcome {
            padding: 12px 16px;
            border-radius: 10px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .outcome:hover {
            transform: scale(1.05);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .outcome.favored {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .outcome.underdog {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .outcome.neutral {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
        }

        .market-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
            padding-top: 12px;
            border-top: 1px solid #cbd5e1;
            font-size: 0.8rem;
            color: #64748b;
            font-weight: 500;
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            display: block;
            margin-bottom: 2px;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-weight: 700;
            color: #374151;
        }

        .chat-input-container {
            padding: 20px;
            background: rgba(248, 250, 252, 0.9);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .chat-input {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .input-field {
            flex: 1;
            padding: 16px 22px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            background: white;
            font-size: 1rem;
            resize: none;
            max-height: 120px;
            min-height: 52px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .input-field:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .send-button {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            padding: 16px 22px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 52px;
            height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
            font-size: 1rem;
        }

        .send-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(99, 102, 241, 0.4);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 10px;
            padding: 16px 20px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
            max-width: fit-content;
            margin-bottom: 15px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #6366f1;
            animation: typing 1.5s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; transform: scale(0.8); }
            30% { opacity: 1; transform: scale(1); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            color: #64748b;
        }

        .welcome-message h2 {
            color: #1e293b;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .welcome-message p {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .example-questions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 25px;
        }

        .example-question {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            border: 2px solid #cbd5e1;
            padding: 15px 18px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            color: #475569;
            font-weight: 500;
            text-align: left;
        }

        .example-question:hover {
            background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            border-color: #6366f1;
        }

        .loading-state {
            display: none;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 10px;
            margin: 10px 0;
            color: #6366f1;
            font-weight: 500;
        }

        .ai-analysis {
            background: linear-gradient(135deg, #fef3c7, #fcd34d);
            border: 2px solid #f59e0b;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border-left: 6px solid #f59e0b;
        }

        .ai-analysis-header {
            font-weight: 700;
            color: #92400e;
            margin-bottom: 12px;
            font-size: 1.05rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-analysis-content {
            color: #78350f;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .chat-container {
                height: 92vh;
                margin: 15px;
                max-width: none;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .market-outcomes {
                grid-template-columns: 1fr;
            }

            .example-questions {
                grid-template-columns: 1fr;
            }

            .market-stats {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>üéØ Polymarket AI Betting Advisor</h1>
            <p>AI-powered insights on prediction markets using real-time data</p>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="statusText">Loading market data...</span>
            </div>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                <h2>Welcome to Your Personal Betting Advisor!</h2>
                <p>Ask me about any betting markets and I'll analyze the data to give you intelligent predictions and insights.</p>
                <div class="example-questions">
                    <div class="example-question" onclick="askQuestion('Who will win the Premier League this season?')">
                        ‚öΩ Who will win the Premier League this season?
                    </div>
                    <div class="example-question" onclick="askQuestion('What are the Fed interest rate predictions?')">
                        üí∞ What are the Fed rate predictions?
                    </div>
                    <div class="example-question" onclick="askQuestion('Show me the highest volume markets')">
                        üìà Show me high volume markets
                    </div>
                    <div class="example-question" onclick="askQuestion('What NFL games should I bet on?')">
                        üèà What NFL games should I bet on?
                    </div>
                </div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <span>AI is analyzing markets...</span>
        </div>

        <div class="chat-input-container">
            <div class="chat-input">
                <textarea 
                    class="input-field" 
                    id="messageInput" 
                    placeholder="Ask me about any betting opportunity..."
                    rows="1"
                ></textarea>
                <button class="send-button" id="sendButton" onclick="sendMessage()">
                    ‚ñ∂Ô∏è
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            // Your GitHub raw JSON file URL
            POLYMARKET_DATA_URL: 'https://raw.githubusercontent.com/sovagpt/fa/main/polymarket_markets_full.json',
            
            // OpenRouter API configuration
            OPENROUTER_API_URL: 'https://openrouter.ai/api/v1/chat/completions',
            
            // Model to use for AI responses
            MODEL: 'anthropic/claude-3.5-sonnet:beta'
        };

        // Global variables
        let polymarketData = null;
        let chatHistory = [];
        let isLoading = false;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            try {
                await loadPolymarketData();
                setupEventListeners();
                updateStatus('‚úÖ Market data loaded - Ready to chat!', true);
            } catch (error) {
                console.error('Failed to initialize app:', error);
                updateStatus('‚ùå Failed to load market data', false);
            }
        }

        async function loadPolymarketData() {
            try {
                updateStatus('üì° Loading market data...', false);
                const response = await fetch(CONFIG.POLYMARKET_DATA_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                polymarketData = await response.json();
                console.log(`Loaded ${polymarketData.markets?.length || 0} markets`);
                
            } catch (error) {
                console.error('Error loading Polymarket data:', error);
                throw error;
            }
        }

        function updateStatus(text, isReady) {
            const statusText = document.getElementById('statusText');
            const statusDot = document.querySelector('.status-dot');
            
            statusText.textContent = text;
            statusDot.style.background = isReady ? '#10b981' : '#f59e0b';
        }

        function setupEventListeners() {
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');

            // Input handling
            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Auto-resize textarea
            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });

            // Send button
            sendButton.addEventListener('click', sendMessage);
        }

        function askQuestion(question) {
            const messageInput = document.getElementById('messageInput');
            messageInput.value = question;
            sendMessage();
        }

        async function sendMessage() {
            if (isLoading) return;
            
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            if (!polymarketData) {
                alert('Market data is still loading. Please wait a moment and try again.');
                return;
            }

            // Clear welcome message if it exists
            const welcomeMsg = document.querySelector('.welcome-message');
            if (welcomeMsg) {
                welcomeMsg.remove();
            }

            // Clear input
            input.value = '';
            input.style.height = 'auto';
            
            // Add user message
            addMessage('user', message);
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                isLoading = true;
                const response = await getAIResponse(message);
                hideTypingIndicator();
                addMessage('bot', response);
            } catch (error) {
                console.error('Error getting AI response:', error);
                hideTypingIndicator();
                addMessage('bot', '‚ùå Sorry, I encountered an error while processing your request. Please try again.');
            } finally {
                isLoading = false;
            }
        }

        async function getAIResponse(userMessage) {
            // Find relevant markets based on user query
            const relevantMarkets = findRelevantMarkets(userMessage);
            
            // Create context for AI
            const context = createAIContext(userMessage, relevantMarkets);
            
            // Get AI response using OpenRouter
            const aiResponse = await callOpenRouterAPI(context);
            
            // Format response with market cards
            return formatResponseWithMarkets(aiResponse, relevantMarkets);
        }

        function findRelevantMarkets(query) {
            const queryLower = query.toLowerCase();
            const markets = polymarketData.markets || [];
            
            // Define search keywords and categories
            const categories = {
                'premier_league': ['premier league', 'epl', 'english premier', 'manchester', 'liverpool', 'chelsea', 'arsenal', 'tottenham'],
                'football': ['football', 'soccer', 'fifa', 'world cup', 'uefa', 'champions league'],
                'american_football': ['nfl', 'super bowl', 'american football', 'chiefs', 'cowboys', 'patriots'],
                'basketball': ['nba', 'basketball', 'lakers', 'warriors', 'lebron', 'finals'],
                'baseball': ['mlb', 'baseball', 'yankees', 'dodgers', 'world series'],
                'fed_rates': ['fed', 'federal reserve', 'interest rate', 'fomc', 'jerome powell'],
                'politics': ['election', 'president', 'biden', 'trump', 'congress', 'senate'],
                'crypto': ['bitcoin', 'ethereum', 'crypto', 'btc', 'eth', 'binance', 'coinbase'],
                'stocks': ['stock', 'nasdaq', 'dow', 'sp500', 's&p', 'apple', 'tesla', 'nvidia'],
                'entertainment': ['oscar', 'emmy', 'grammy', 'movie', 'netflix', 'disney']
            };
            
            let relevantMarkets = [];
            let searchScore = {};
            
            // Score markets based on relevance
            markets.forEach((market, index) => {
                const title = market.title.toLowerCase();
                const description = market.description.toLowerCase();
                let score = 0;
                
                // Direct keyword matching
                const queryWords = queryLower.split(' ').filter(word => word.length > 2);
                queryWords.forEach(word => {
                    if (title.includes(word)) score += 10;
                    if (description.includes(word)) score += 5;
                });
                
                // Category matching
                Object.entries(categories).forEach(([category, keywords]) => {
                    keywords.forEach(keyword => {
                        if (queryLower.includes(keyword)) {
                            if (title.includes(keyword) || description.includes(keyword)) {
                                score += 15;
                            }
                        }
                    });
                });
                
                // Volume weighting (popular markets are more relevant)
                if (market.volume24h > 1000000) score += 3;
                if (market.volume24h > 5000000) score += 2;
                
                if (score > 0) {
                    searchScore[index] = score;
                }
            });
            
            // Sort by relevance score and get top results
            relevantMarkets = Object.entries(searchScore)
                .sort(([, a], [, b]) => b - a)
                .slice(0, 6)
                .map(([index]) => markets[parseInt(index)]);
            
            // If no relevant markets found, show highest volume markets
            if (relevantMarkets.length === 0) {
                relevantMarkets = markets
                    .filter(m => m.volume24h > 0)
                    .sort((a, b) => (b.volume24h || 0) - (a.volume24h || 0))
                    .slice(0, 5);
            }
            
            return relevantMarkets;
        }

        function createAIContext(userMessage, relevantMarkets) {
            const marketData = relevantMarkets.map(market => ({
                title: market.title,
                description: market.description,
                outcomes: market.outcomes,
                volume24h: market.volume24h,
                volumeTotal: market.volumeTotal,
                liquidity: market.liquidity,
                favoredOutcome: market.favoredOutcome
            }));
            
            return `
        User Question: "${userMessage}"

        Relevant Betting Markets Data:
        ${JSON.stringify(marketData, null, 2)}

        Instructions:
        1. Analyze the provided betting markets data that are relevant to the user's question
        2. Give your expert opinion on the most likely outcomes based on the market data
        3. Explain your reasoning using the odds, volume, and market sentiment
        4. Be conversational and engaging
        5. If asked about who will win something, look at the market odds and give your prediction
        6. Consider volume and liquidity as indicators of market confidence
        7. Keep your response concise but informative
        8. Don't mention that you're looking at JSON data - just analyze the markets naturally

        Please provide your analysis and predictions based on this market data.
        `;
        }

        async function callOpenRouterAPI(context) {
            const response = await fetch(CONFIG.OPENROUTER_API_URL, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${process.env.OPENROUTER_API_KEY}`,
                    'Content-Type': 'application/json',
                    'HTTP-Referer': window.location.origin,
                    'X-Title': 'Polymarket AI Advisor'
                },
                body: JSON.stringify({
                    model: CONFIG.MODEL,
                    messages: [
                        {
                            role: 'system',
                            content: 'You are an expert betting analyst who provides intelligent insights on prediction markets. Analyze market data and give clear, confident predictions with reasoning.'
                        },
                        {
                            role: 'user',
                            content: context
                        }
                    ],
                    max_tokens: 1000,
                    temperature: 0.7
                })
            });
            
            if (!response.ok) {
                throw new Error(`OpenRouter API error: ${response.status}`);
            }
            
            const data = await response.json();
            return data.choices[0].message.content;
        }

        function formatResponseWithMarkets(aiResponse, relevantMarkets) {
            let formattedResponse = aiResponse;
            
            if (relevantMarkets.length > 0) {
                formattedResponse += '<br><br><strong>üìä Relevant Markets:</strong><br>';
                
                relevantMarkets.forEach((market, index) => {
                    formattedResponse += createMarketCard(market, index);
                });
            }
            
            return formattedResponse;
        }

        function createMarketCard(market, index) {
            const formatVolume = (vol) => {
                if (!vol || vol === 0) return '$0';
                if (vol > 1000000) return `${(vol / 1000000).toFixed(1)}M`;
                if (vol > 1000) return `${(vol / 1000).toFixed(1)}K`;
                return `${vol.toFixed(0)}`;
            };
            
            const formatPrice = (price) => `${(price * 100).toFixed(1)}%`;
            
            const outcome1 = market.outcomes[0];
            const outcome2 = market.outcomes[1];
            
            // Determine which outcome is favored
            const outcome1Class = outcome1.price > 0.6 ? 'favored' : outcome1.price < 0.4 ? 'underdog' : 'neutral';
            const outcome2Class = outcome2.price > 0.6 ? 'favored' : outcome2.price < 0.4 ? 'underdog' : 'neutral';
            
            return `
                <div class="market-card" onclick="analyzeSpecificMarket('${market.id}', '${market.title.replace(/'/g, "\\'")}')">
                    <div class="market-title">${market.title}</div>
                    <div class="market-outcomes">
                        <div class="outcome ${outcome1Class}">
                            ${outcome1.name}: ${formatPrice(outcome1.price)}
                        </div>
                        <div class="outcome ${outcome2Class}">
                            ${outcome2.name}: ${formatPrice(outcome2.price)}
                        </div>
                    </div>
                    <div class="market-stats">
                        <div class="stat-item">
                            <span class="stat-label">24h Volume</span>
                            <span class="stat-value">${formatVolume(market.volume24h)}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Total Volume</span>
                            <span class="stat-value">${formatVolume(market.volumeTotal)}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Liquidity</span>
                            <span class="stat-value">${formatVolume(market.liquidity)}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        async function analyzeSpecificMarket(marketId, marketTitle) {
            const market = polymarketData.markets.find(m => m.id === marketId);
            if (!market) return;
            
            // Add user message showing they clicked on this market
            addMessage('user', `Tell me more about: ${marketTitle}`);
            
            showTypingIndicator();
            
            try {
                const detailedAnalysis = await getDetailedMarketAnalysis(market);
                hideTypingIndicator();
                addMessage('bot', detailedAnalysis);
            } catch (error) {
                console.error('Error getting detailed analysis:', error);
                hideTypingIndicator();
                addMessage('bot', '‚ùå Sorry, I couldn\'t analyze this specific market right now.');
            }
        }

        async function getDetailedMarketAnalysis(market) {
            const context = `
        Provide a detailed analysis of this specific betting market:

        Title: ${market.title}
        Description: ${market.description}
        Outcomes: ${JSON.stringify(market.outcomes)}
        24h Volume: ${market.volume24h}
        Total Volume: ${market.volumeTotal}
        Liquidity: ${market.liquidity}
        Favored Outcome: ${market.favoredOutcome}
        End Date: ${market.endTime}

        Please provide:
        1. What this market is betting on (in simple terms)
        2. Current odds analysis
        3. Your prediction and confidence level
        4. Key factors that could influence the outcome
        5. Risk assessment

        Be detailed and specific in your analysis.
        `;

            const aiResponse = await callOpenRouterAPI(context);
            
            return `
                <div class="ai-analysis">
                    <div class="ai-analysis-header">
                        ü§ñ Detailed Market Analysis
                    </div>
                    <div class="ai-analysis-content">
                        ${aiResponse}
                    </div>
                </div>
                
                ${createMarketCard(market, 0)}
            `;
        }

        function addMessage(sender, content) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = sender === 'user' ? 'You' : 'AI';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.innerHTML = content;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
            messagesContainer.appendChild(messageDiv);
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Add to chat history
            chatHistory.push({ sender, content });
        }

        function showTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            const messagesContainer = document.getElementById('chatMessages');
            indicator.style.display = 'flex';
            messagesContainer.appendChild(indicator);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            indicator.style.display = 'none';
        }

        // Error handling
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled promise rejection:', e.reason);
        });
    </script>
</body>
</html>
